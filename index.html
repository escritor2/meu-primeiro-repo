<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Offline Music Player Universal</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap');

  :root {
    --color-bg: #121214;
    --color-bg-alt: #1c1c1e;
    --color-primary: #4f46e5;
    --color-primary-light: #818cf8;
    --color-text: #e4e4e7;
    --color-text-muted: #a1a1aa;
    --color-accent: #7c3aed;
    --color-shadow: rgba(0,0,0,0.5);
    --radius: 0.75rem;
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0; 
    background: var(--color-bg);
    color: var(--color-text);
    font-family: "Poppins", sans-serif;
    display: flex;    
    flex-direction: column;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  header {
    position: sticky;
    top: 0;
    background: var(--color-bg-alt);
    padding: 1rem 2rem;
    box-shadow: 0 2px 10px var(--color-shadow);
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 10;
  }

  header h1 {
    font-weight: 700;
    font-size: 1.5rem;
    user-select: none;
    letter-spacing: 0.06em;
  }

  main {
    flex: 1;
    max-width: 900px;
    margin: 2rem auto 4rem;
    width: 100%;
    padding: 0 1rem;
  }

  .file-input-label {
    display: inline-block;
    padding: 0.65rem 1.4rem;
    background: var(--color-primary);
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    border-radius: var(--radius);
    cursor: pointer;
    user-select: none;
    box-shadow: 0 6px 10px -4px var(--color-primary-light);
    transition: background var(--transition);
    margin-bottom: 1.5rem;
  }
  .file-input-label:hover,
  .file-input-label:focus-visible {
    background: var(--color-primary-light);
  }
  input[type="file"] {
    display: none;
  }

  .playlist {
    background: var(--color-bg-alt);
    padding: 1.5rem 1.5rem 2rem;
    border-radius: var(--radius);
    box-shadow: 0 8px 24px rgba(0,0,0,0.8);
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.4rem;
    max-height: 350px;
    overflow-y: auto;
  }

  .playlist.empty::before {
    content: "Nenhuma m칰sica adicionada";
    color: var(--color-text-muted);
    text-align: center;
    padding: 2rem;
    display: block;
  }

  .song {
    padding: 0.6rem 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    font-weight: 600;
    color: var(--color-text-muted);
    transition:
      background-color var(--transition),
      color var(--transition),
      transform var(--transition);
    user-select: none;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .song:hover {
    background: var(--color-primary-light);
    color: white;
    transform: scale(1.02);
    box-shadow: 0 0 10px var(--color-primary);
  }
  .song.active {
    background: var(--color-primary);
    color: white;
    box-shadow: 0 0 12px var(--color-primary);
  }
  .song:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  svg.music-note {
    width: 1.2rem;
    height: 1.2rem;
    fill: var(--color-primary);
  }
  .song.active svg.music-note {
    fill: white;
  }

  .player-controls {
    margin-top: 2rem;
    background: var(--color-bg-alt);
    border-radius: var(--radius);
    padding: 1.2rem 2rem;
    box-shadow: 0 8px 24px rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }
  button.control-btn {
    background: none;
    border: none;
    color: var(--color-primary-light);
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    padding: 0.1rem;
    border-radius: 50%;
  }
  button.control-btn:hover,
  button.control-btn:focus-visible {
    color: var(--color-primary);
    transform: scale(1.12);
    outline-offset: 4px;
  }
  button.control-btn:active {
    transform: scale(0.95);
  }
  button.control-btn.active {
    color: var(--color-primary);
  }

  .player-info {
    text-align: center;
    margin-top: 1rem;
    font-weight: 600;
    font-size: 1.15rem;
    color: var(--color-text-muted);
  }

  .player-info strong {
    color: var(--color-text);
  }

  .progress-container {
    width: 100%;
    height: 6px;
    background: var(--color-bg);
    border-radius: 3px;
    margin-top: 1rem;
    cursor: pointer;
  }

  .progress-bar {
    height: 100%;
    background: var(--color-primary);
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s linear;
  }

  .volume-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: auto;
  }

  .volume-slider {
    width: 80px;
    accent-color: var(--color-primary);
  }

  .time-display {
    font-size: 0.9rem;
    color: var(--color-text-muted);
    margin: 0 1rem;
  }

  audio {
    display: none;
  }

  /* Scrollbar styling for playlist */
  .playlist::-webkit-scrollbar {
    width: 8px;
  }
  .playlist::-webkit-scrollbar-track {
    background: var(--color-bg-alt);
    border-radius: var(--radius);
  }
  .playlist::-webkit-scrollbar-thumb {
    background: var(--color-primary-light);
    border-radius: var(--radius);
  }
</style>
</head>
<body>
<header>
  <h1>Offline Music Player Universal</h1>
</header>
<main>
  <label class="file-input-label" for="file-input" tabindex="0">Adicionar M칰sicas</label>
  <input type="file" id="file-input" multiple accept="audio/*" aria-label="Adicionar m칰sicas para a playlist" />
  
  <section class="playlist" aria-label="Lista de m칰sicas" role="list" id="playlist"></section>
  
  <div class="player-controls" role="region" aria-label="Controles do player">
    <button class="control-btn" id="shuffle-btn" aria-label="Modo aleat칩rio" title="Modo aleat칩rio">
      &#x1F500;
    </button>
    <button class="control-btn" id="prev-btn" aria-label="M칰sica anterior" title="M칰sica anterior" disabled>
      &#9664;&#9664;
    </button>
    <button class="control-btn" id="play-pause-btn" aria-label="Tocar m칰sica" title="Tocar m칰sica" disabled>
      &#9654;
    </button>
    <button class="control-btn" id="next-btn" aria-label="Pr칩xima m칰sica" title="Pr칩xima m칰sica" disabled>
      &#9654;&#9654;
    </button>
    <button class="control-btn" id="repeat-btn" aria-label="Modo repeti칞칚o" title="Modo repeti칞칚o">
      &#x1F501;
    </button>
    
    <div class="time-display">
      <span id="current-time">0:00</span> / <span id="duration">0:00</span>
    </div>
    
    <div class="volume-control">
      <span aria-hidden="true">游댉</span>
      <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.01" value="0.7" 
             aria-label="Controle de volume">
    </div>
  </div>
  
  <div class="progress-container" id="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>
  
  <div class="player-info" aria-live="polite" aria-atomic="true" id="player-info">
    Nenhuma m칰sica selecionada
  </div>
  
  <audio id="audio" preload="metadata"></audio>
</main>

<script>
  (() => {
    'use strict';

    const fileInput = document.getElementById('file-input');
    const playlistEl = document.getElementById('playlist');
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const repeatBtn = document.getElementById('repeat-btn');
    const playerInfo = document.getElementById('player-info');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    const volumeSlider = document.getElementById('volume-slider');
    const currentTimeEl = document.getElementById('current-time');
    const durationEl = document.getElementById('duration');

    let songs = [];
    let currentIndex = -1;
    let isPlaying = false;
    let isShuffle = false;
    let isRepeat = false;

    function savePlaylist() {
      localStorage.setItem('offlineMusicPlayer_playlist', JSON.stringify(songs.map(file => file.name)));
    }

    function loadPlaylist() {
      const saved = localStorage.getItem('offlineMusicPlayer_playlist');
      if (saved) {
        const songNames = JSON.parse(saved);
        updatePlayerInfo(`Playlist carregada (${songNames.length} m칰sicas)`);
      }
    }

    function createSongElement(file, index) {
      const songEl = document.createElement('div');
      songEl.className = 'song';
      songEl.setAttribute('role', 'listitem');
      songEl.tabIndex = 0;
      songEl.dataset.index = index;

      const musicNote = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      musicNote.setAttribute('viewBox', '0 0 24 24');
      musicNote.classList.add('music-note');
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('d', 'M12 3v10.55A4 4 0 1 0 14 17V7h4V3h-6z');
      musicNote.appendChild(path);

      songEl.appendChild(musicNote);
      const fileName = document.createElement('span');
      fileName.textContent = file.name;
      songEl.appendChild(fileName);

      songEl.addEventListener('click', () => {
        loadSong(index);
        playSong();
      });
      songEl.addEventListener('keypress', (e) => {
        if(e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          loadSong(index);
          playSong();
        }
      });

      return songEl;
    }

    function renderPlaylist() {
      playlistEl.innerHTML = '';
      
      if (songs.length === 0) {
        playlistEl.classList.add('empty');
        return;
      }
      
      playlistEl.classList.remove('empty');
      songs.forEach((file, idx) => {
        const songEl = createSongElement(file, idx);
        if (idx === currentIndex) songEl.classList.add('active');
        playlistEl.appendChild(songEl);
      });
    }

    function loadSong(index) {
      if (index < 0 || index >= songs.length) return;
      currentIndex = index;
      const file = songs[index];
      const fileURL = URL.createObjectURL(file);
      audio.src = fileURL;
      updateActiveSong();
      updatePlayerInfo(`Selecionado: ${file.name}`);
      playPauseBtn.disabled = false;
      updateControls();
      
      audio.addEventListener('loadedmetadata', updateTimeDisplay, { once: true });
      
      // Verifica se o arquivo 칠 suportado
      audio.addEventListener('error', () => {
        updatePlayerInfo(`Erro: Formato n칚o suportado (${file.name})`);
        console.error(`Formato de 치udio n칚o suportado: ${file.type}`);
      }, { once: true });
    }

    function updateActiveSong() {
      const songElements = playlistEl.querySelectorAll('.song');
      songElements.forEach((el, i) => {
        el.classList.toggle('active', i === currentIndex);
      });
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function updateTimeDisplay() {
      currentTimeEl.textContent = formatTime(audio.currentTime);
      durationEl.textContent = formatTime(audio.duration || 0);
    }

    function playSong() {
      if (currentIndex === -1) return;
      audio.play()
        .then(() => {
          isPlaying = true;
          playPauseBtn.innerHTML = '&#10073;&#10073;';
          playPauseBtn.setAttribute('aria-label', 'Pausar m칰sica');
          playPauseBtn.title = 'Pausar m칰sica';
          updatePlayerInfo(`Tocando: ${songs[currentIndex].name}`);
          updateControls();
        })
        .catch(error => {
          console.error("Erro ao reproduzir:", error);
          updatePlayerInfo(`Erro ao reproduzir: ${songs[currentIndex].name} (${error.message})`);
        });
    }

    function pauseSong() {
      audio.pause();
      isPlaying = false;
      playPauseBtn.innerHTML = '&#9654;';
      playPauseBtn.setAttribute('aria-label', 'Tocar m칰sica');
      playPauseBtn.title = 'Tocar m칰sica';
      updatePlayerInfo(`Pausado: ${songs[currentIndex].name}`);
      updateControls();
    }

    function updateControls() {
      prevBtn.disabled = currentIndex <= 0;
      nextBtn.disabled = currentIndex >= songs.length -1;
    }

    function playPauseToggle() {
      if (isPlaying) {
        pauseSong();
      } else {
        playSong();
      }
    }

    function playNext() {
      if (isShuffle) {
        loadSong(Math.floor(Math.random() * songs.length));
      } else if (currentIndex < songs.length - 1) {
        loadSong(currentIndex + 1);
      } else if (isRepeat) {
        loadSong(0);
      } else {
        pauseSong();
        return;
      }
      playSong();
    }

    function playPrev() {
      if (currentIndex > 0) {
        loadSong(currentIndex -1);
        playSong();
      }
    }

    function toggleShuffle() {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active', isShuffle);
      updatePlayerInfo(isShuffle ? 'Modo aleat칩rio ativado' : 'Modo aleat칩rio desativado');
    }

    function toggleRepeat() {
      isRepeat = !isRepeat;
      repeatBtn.classList.toggle('active', isRepeat);
      updatePlayerInfo(isRepeat ? 'Modo repeti칞칚o ativado' : 'Modo repeti칞칚o desativado');
    }

    function updatePlayerInfo(text) {
      playerInfo.textContent = text;
    }

    function clearPlaylist() {
      songs = [];
      currentIndex = -1;
      audio.src = '';
      isPlaying = false;
      playPauseBtn.disabled = true;
      playPauseBtn.innerHTML = '&#9654;';
      updatePlayerInfo('Nenhuma m칰sica selecionada');
      renderPlaylist();
      updateControls();
    }

    function updateProgressBar() {
      const { currentTime, duration } = audio;
      const progressPercent = (currentTime / duration) * 100;
      progressBar.style.width = `${progressPercent}%`;
      updateTimeDisplay();
    }

    function setProgress(e) {
      const width = this.clientWidth;
      const clickX = e.offsetX;
      const duration = audio.duration;
      audio.currentTime = (clickX / width) * duration;
    }

    function setVolume() {
      audio.volume = this.value;
    }

    // Event Listeners
    fileInput.addEventListener('change', () => {
      const files = Array.from(fileInput.files);
      if (files.length === 0) return;
      
      // Filtra apenas arquivos que parecem ser de 치udio
      const audioFiles = files.filter(file => {
        return file.type.startsWith('audio/') || 
               ['.mp3', '.wav', '.ogg', '.m4a', '.flac', '.aac', '.webm', '.opus'].some(ext => 
                 file.name.toLowerCase().endsWith(ext));
      });
      
      if (audioFiles.length === 0) {
        updatePlayerInfo('Nenhum arquivo de 치udio v치lido encontrado');
        return;
      }
      
      songs = songs.concat(audioFiles);
      savePlaylist();
      renderPlaylist();
      if(currentIndex === -1) {
        loadSong(0);
      } else {
        updateControls();
      }
    });

    playPauseBtn.addEventListener('click', playPauseToggle);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);
    shuffleBtn.addEventListener('click', toggleShuffle);
    repeatBtn.addEventListener('click', toggleRepeat);

    audio.addEventListener('timeupdate', updateProgressBar);
    progressContainer.addEventListener('click', setProgress);
    volumeSlider.addEventListener('input', setVolume);
    audio.addEventListener('ended', playNext);

    // Drag and Drop
    document.addEventListener('dragover', (e) => {
      e.preventDefault();
      document.body.classList.add('dragover');
    });

    document.addEventListener('drop', (e) => {
      e.preventDefault();
      document.body.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      if (files.length > 0) {
        const audioFiles = files.filter(file => {
          return file.type.startsWith('audio/') || 
                 ['.mp3', '.wav', '.ogg', '.m4a', '.flac', '.aac', '.webm', '.opus'].some(ext => 
                   file.name.toLowerCase().endsWith(ext));
        });
        
        if (audioFiles.length === 0) {
          updatePlayerInfo('Nenhum arquivo de 치udio v치lido encontrado');
          return;
        }
        
        songs = songs.concat(audioFiles);
        savePlaylist();
        renderPlaylist();
        if (currentIndex === -1) {
          loadSong(0);
        } else {
          updateControls();
        }
      }
    });
    document.addEventListener('dragleave', () => {
      document.body.classList.remove('dragover');
    });

    // Inicializa칞칚o
    loadPlaylist();
    renderPlaylist();
    audio.volume = volumeSlider.value;

  })();
</script>
</body>
</html>